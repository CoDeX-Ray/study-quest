import{c as x,b as V,E as P,a as R,r as i,j as e,B as m,o as b,s as a}from"./index-BP1FSaq1.js";import{C as M}from"./card-BE56yErZ.js";import{A as w,a as k,b as N,c as C,d as S,e as A,f as U,g as O}from"./alert-dialog-D6s96T1o.js";import{S as I,a as F,b as H,c as J,d as p}from"./select-g3ySVwCt.js";import{A as X}from"./arrow-left-DCqt4Xho.js";import{U as $}from"./users-CZ08qHbK.js";import{T as G}from"./trash-2-CrLKROgE.js";import"./index-D9vvMaiu.js";import"./chevron-down-gDIPlPlM.js";const K=x("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);const Q=x("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const W=x("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const Y=x("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),ie=()=>{const f=V(),{toast:l}=P(),{isAdmin:u,loading:v}=R(),[E,j]=i.useState([]),[D,L]=i.useState(!0),[o,d]=i.useState(null),[r,h]=i.useState(null),[n,g]=i.useState(null);i.useEffect(()=>{!v&&!u&&f("/dashboard")},[u,v,f]),i.useEffect(()=>{u&&(async()=>{const{data:t,error:c}=await a.from("profiles").select("*").order("created_at",{ascending:!1});c?l({title:"Error",description:"Failed to load users",variant:"destructive"}):j(t||[]),L(!1)})()},[u,l]);const _=s=>{switch(s){case"admin":return"destructive";case"professional":return"default";case"student":return"secondary";default:return"outline"}},B=s=>{switch(s){case"active":return"default";case"blocked":return"secondary";case"banned":return"destructive";default:return"outline"}},T=async()=>{if(!(!o||!r))try{if(r==="delete"){const{error:t}=await a.from("profiles").delete().eq("id",o.id);if(t)throw t;l({title:"Success",description:"User deleted successfully"})}else{const t=r==="unblock"?"active":r,{error:c}=await a.from("profiles").update({status:t}).eq("id",o.id);if(c)throw c;l({title:"Success",description:`User ${r}ed successfully`})}const{data:s}=await a.from("profiles").select("*").order("created_at",{ascending:!1});j(s||[])}catch(s){l({title:"Error",description:s.message,variant:"destructive"})}finally{d(null),h(null)}},z=async s=>{if(n)try{const{error:t}=await a.from("user_roles").delete().eq("user_id",n.id);if(t)throw t;const{error:c}=await a.from("user_roles").insert([{user_id:n.id,role:s}]);if(c)throw c;const{error:y}=await a.from("profiles").update({role:s}).eq("id",n.id);if(y)throw y;l({title:"Success",description:"User role updated successfully"});const{data:q}=await a.from("profiles").select("*").order("created_at",{ascending:!1});j(q||[])}catch(t){l({title:"Error",description:t.message,variant:"destructive"})}finally{g(null)}};return D?e.jsx("div",{className:"p-8",children:"Loading..."}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-destructive/5 via-background to-warning/5 p-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"ghost",onClick:()=>f("/admin/dashboard"),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("h1",{className:"text-4xl font-bold text-foreground flex items-center gap-3",children:[e.jsx($,{className:"h-10 w-10 text-primary"}),"User Management"]})]}),e.jsx(M,{className:"border-border/50 bg-surface",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Name"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Email"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Role"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Level"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"XP"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Joined"}),e.jsx("th",{className:"text-left p-4 font-semibold text-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:E.map(s=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-surface-elevated",children:[e.jsx("td",{className:"p-4 text-foreground",children:s.full_name||"N/A"}),e.jsx("td",{className:"p-4 text-foreground",children:s.email}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:_(s.role),children:s.role}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>g(s),children:e.jsx(Y,{className:"h-4 w-4"})})]})}),e.jsx("td",{className:"p-4",children:e.jsx(b,{variant:B(s.status),children:s.status})}),e.jsx("td",{className:"p-4 text-foreground",children:s.level}),e.jsx("td",{className:"p-4 text-foreground",children:s.xp}),e.jsx("td",{className:"p-4 text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="blocked"?e.jsx(m,{size:"sm",variant:"outline",onClick:()=>{d(s),h("unblock")},children:e.jsx(Q,{className:"h-4 w-4"})}):e.jsx(m,{size:"sm",variant:"outline",onClick:()=>{d(s),h("block")},children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>{d(s),h("ban")},children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"destructive",onClick:()=>{d(s),h("delete")},children:e.jsx(G,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(w,{open:!!o&&!!r,onOpenChange:()=>{d(null),h(null)},children:e.jsxs(k,{children:[e.jsxs(N,{children:[e.jsxs(C,{children:["Confirm ",r," user"]}),e.jsxs(S,{children:["Are you sure you want to ",r," ",o?.full_name||o?.email,"?",r==="delete"&&" This action cannot be undone."]})]}),e.jsxs(A,{children:[e.jsx(U,{children:"Cancel"}),e.jsx(O,{onClick:T,children:"Confirm"})]})]})}),e.jsx(w,{open:!!n,onOpenChange:()=>g(null),children:e.jsxs(k,{children:[e.jsxs(N,{children:[e.jsx(C,{children:"Change User Role"}),e.jsxs(S,{children:["Select a new role for ",n?.full_name||n?.email]})]}),e.jsxs(I,{onValueChange:z,children:[e.jsx(F,{children:e.jsx(H,{placeholder:"Select role"})}),e.jsxs(J,{children:[e.jsx(p,{value:"student",children:"Student"}),e.jsx(p,{value:"professional",children:"Professional"}),e.jsx(p,{value:"admin",children:"Admin"})]})]}),e.jsx(A,{children:e.jsx(U,{children:"Cancel"})})]})})]})};export{ie as default};
