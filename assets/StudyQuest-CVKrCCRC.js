import{c as L,u as re,r as a,s as _,j as e,B as h,o as ye,C as ae,h as E,X as R,b as be,p as Ne,D as Z,d as ee,e as se,f as X}from"./index-BP1FSaq1.js";import{C as H}from"./card-BE56yErZ.js";import{D as ie,a as ve,b as ne,c as le,d as ce,e as oe}from"./dialog-CY8YZYBW.js";import{I as Ce}from"./input-BeUSuKCR.js";import{U as Se,A as ke,a as _e,b as Ae,S as De,L as Ee}from"./LeaderboardDialog-CUDNCjbe.js";import{S as Le}from"./search-5o4Bzv-G.js";import{A as te,E as ze}from"./AddCardItemDialog-BSP2sxOY.js";import{C as Ie}from"./chevron-down-gDIPlPlM.js";import{T as Fe}from"./trophy-D_9zHvL1.js";import"./tabs-DfF0Ph-w.js";import"./award-SuZ_3qse.js";import"./label-CMIARZuf.js";import"./textarea-BTTANauF.js";import"./switch-BhGMyASH.js";import"./index-D9vvMaiu.js";const Me=L("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);const Pe=L("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);const Te=L("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);const Re=L("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const qe=L("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const Oe=L("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),$e=({children:m,cardId:C,cardTitle:d})=>{const{user:j}=re(),[l,x]=a.useState(!1),[z,g]=a.useState(""),[q,u]=a.useState([]),[k,f]=a.useState(new Set),[A,S]=a.useState(!1),[I,U]=a.useState(!1);a.useEffect(()=>{l&&(D(),F())},[l]);const D=async()=>{if(j)try{const{data:r,error:p}=await _.from("friends").select(`
          friend_id,
          user_id,
          profiles:friend_id (
            id,
            full_name,
            avatar_url,
            email,
            role
          )
        `).or(`user_id.eq.${j.id},friend_id.eq.${j.id}`).eq("status","accepted");if(p)throw p;const y=[];r&&r.forEach(b=>{const P=b.friend_id===j.id?b.user_id:b.friend_id;b.profiles&&!Array.isArray(b.profiles)&&y.push({id:P,...b.profiles})}),u(y)}catch(r){console.error("Error fetching friends:",r)}},F=async()=>{try{const{data:r,error:p}=await _.from("shared_cards").select("shared_with_user_id").eq("card_id",C);if(p)throw p;r&&f(new Set(r.map(y=>y.shared_with_user_id)))}catch(r){console.error("Error fetching shared with:",r)}},M=async r=>{if(j){S(!0);try{const{error:p}=await _.from("shared_cards").insert({card_id:C,shared_by_user_id:j.id,shared_with_user_id:r});if(p)throw p;f(y=>new Set([...y,r])),E.success("Card shared successfully!")}catch(p){E.error(p.message||"Failed to share card")}finally{S(!1)}}},O=q.filter(r=>r.full_name?.toLowerCase().includes(z.toLowerCase())||r.email.toLowerCase().includes(z.toLowerCase()));return e.jsxs(ie,{open:l,onOpenChange:x,children:[e.jsx(ve,{asChild:!0,children:m}),e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(le,{children:[e.jsxs(ce,{children:['Share "',d,'"']}),e.jsx(oe,{children:"Share this study card deck with your friends"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search friends...",value:z,onChange:r=>g(r.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto space-y-2",children:O.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:q.length===0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:"No friends yet."}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{x(!1)},children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Add Friends"]})]}):e.jsx("p",{children:"No friends match your search."})}):O.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ke,{className:"h-10 w-10",children:[e.jsx(_e,{src:r.avatar_url||void 0}),e.jsx(Ae,{children:r.full_name?.charAt(0)||"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.full_name||"Anonymous"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]})]}),k.has(r.id)?e.jsxs(ye,{variant:"outline",className:"gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),"Shared"]}):e.jsx(h,{size:"sm",onClick:()=>M(r.id),disabled:A,children:"Share"})]},r.id))})]})]})]})},Be=({isCorrect:m,xpEarned:C=0,onComplete:d})=>{const[j,l]=a.useState(!0);return a.useEffect(()=>{const x=setTimeout(()=>{l(!1),setTimeout(d,300)},2e3);return()=>clearTimeout(x)},[d]),j?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",onClick:d,children:e.jsx("div",{className:`relative p-8 md:p-12 rounded-2xl shadow-2xl animate-in zoom-in-95 duration-300 ${m?"bg-green-500":"bg-red-500"}`,children:e.jsx("div",{className:"flex flex-col items-center gap-4",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin-slow",children:e.jsx(ae,{className:"h-16 md:h-20 w-16 md:w-20 text-white"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white animate-in slide-in-from-bottom-4 duration-500",children:"Correct!"}),C>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xl md:text-2xl font-bold text-yellow-300 animate-in slide-in-from-bottom-4 duration-700 delay-300",children:[e.jsx(De,{className:"h-5 w-5 md:h-6 md:w-6 fill-yellow-300"}),"+",C," XP"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(R,{className:"h-16 md:h-20 w-16 md:w-20 text-white"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white animate-in slide-in-from-bottom-4 duration-500",children:"Wrong"})]})})})}):null},is=()=>{const{user:m,loading:C}=re(),d=be(),[j]=Ne(),l=j.get("card"),[x,z]=a.useState(null),[g,q]=a.useState([]),[u,k]=a.useState(0),[f,A]=a.useState(null),[S,I]=a.useState(!1),[U,D]=a.useState(new Set),[F,M]=a.useState(new Set),[O,r]=a.useState(!0),[p,y]=a.useState(!1),[b,P]=a.useState(null),[W,$]=a.useState(0),[de,T]=a.useState(!1);a.useEffect(()=>{!C&&!m&&d("/auth")},[m,C,d]),a.useEffect(()=>{m&&l?Q():m&&!l&&d("/study-hall")},[m,l,d]);const he=s=>{const t=s.trim();let i=[t];const o=parseFloat(t);if(isNaN(o)){const c=[t+"s",t.substring(0,Math.max(0,t.length-1)),t.toUpperCase(),t.charAt(0).toUpperCase()+t.slice(1)].filter(w=>w!==t);i=[t,...c].slice(0,4)}else{const c=[o+1,o-1,o===0?1:o*2].filter((w,N,B)=>B.indexOf(w)===N&&w!==o);i=[t,...c.map(String)].slice(0,4)}for(let c=i.length-1;c>0;c--){const w=Math.floor(Math.random()*(c+1));[i[c],i[w]]=[i[w],i[c]]}return i},n=g[u],me=a.useMemo(()=>n?he(n.back):[],[n]);a.useEffect(()=>{l&&(k(0),I(!1),A(null),D(new Set),M(new Set),y(!1),P(null),$(0))},[l]),a.useEffect(()=>{I(!1),A(null)},[u]);const Q=async()=>{if(l){r(!0);try{const{data:s,error:t}=await _.from("study_cards").select("*").eq("id",l).single();if(t)throw t;const i=s.user_id===m?.id,o=s.is_public,c=await xe(l);if(!i&&!o&&!c){E.error("You don't have access to this card"),d("/study-hall");return}z(s);const{data:w,error:N}=await _.from("study_card_items").select("*").eq("card_id",l).order("order_index",{ascending:!0});if(N)throw N;q(w||[])}catch(s){console.error("Error fetching card:",s),E.error(s.message||"Failed to load card"),r(!1),setTimeout(()=>{d("/study-hall")},2e3);return}finally{r(!1)}}},xe=async s=>{if(!m)return!1;const{data:t}=await _.from("shared_cards").select("id").eq("card_id",s).eq("shared_with_user_id",m.id).single();return!!t},ue=()=>{if(n&&(I(!0),f===null)){const s=n.id;D(t=>new Set([...t,s]))}},ge=s=>{if(!n||S||f!==null)return;A(s);const t=n.id,i=n.back.toLowerCase().trim(),o=s.toLowerCase().trim(),c=i.replace(/\s+/g," ").trim(),w=o.replace(/\s+/g," ").trim();let N=c===w;if(!N){const v=parseFloat(c),J=parseFloat(w);!isNaN(v)&&!isNaN(J)&&(N=v===J)}D(v=>new Set([...v,t]));const B=N?10:0;N?(M(v=>new Set([...v,t])),$(v=>v+B)):$(v=>v+0),P({isCorrect:N,xpEarned:B}),y(!0)},Y=()=>{u<g.length-1&&k(u+1)},fe=()=>{u>0&&k(u-1)},V=()=>{k(0),I(!1),A(null),D(new Set),M(new Set),$(0)},pe=()=>{y(!1),P(null),setTimeout(()=>{u<g.length-1?k(u+1):U.size===g.length&&we()},1e3)},we=async()=>{if(!(!m||!l||g.length===0))try{const s=U.size,t=F.size,i=t*10,{error:o}=await _.from("study_sessions").insert({user_id:m.id,card_id:l,questions_answered:s,correct_answers:t,xp_earned:i,session_date:new Date().toISOString().split("T")[0]});if(o)throw o;T(!0)}catch(s){console.error("Error saving study session:",s),E.error(s.message||"Failed to save progress")}};if(C||O)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto"}),e.jsx("p",{className:"text-gray-400",children:"Loading..."})]})});if(!x)return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:[e.jsxs(h,{variant:"ghost",onClick:()=>d("/study-hall"),className:"mb-4 text-gray-400 hover:text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Back to Study Hall"]}),e.jsx(H,{className:"p-6 md:p-8 text-center bg-gray-800 border-gray-700",children:e.jsx("p",{className:"text-gray-300",children:"Card deck not found."})})]});if(g.length===0)return e.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(h,{variant:"ghost",onClick:()=>d("/study-hall"),className:"text-gray-400 hover:text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:x.title}),x.description&&e.jsx("p",{className:"text-sm text-gray-400",children:x.description})]})]})}),e.jsxs(H,{className:"p-8 text-center space-y-4 bg-gray-800 border-gray-700",children:[e.jsx("p",{className:"text-gray-300",children:"No flashcards in this deck yet."}),x.user_id===m?.id&&e.jsx(te,{cardId:l,onItemAdded:Q,children:e.jsx(h,{className:"bg-pink-500 hover:bg-pink-600",children:"Add First Card"})})]})]})});if(!n||!g[u])return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:[e.jsxs(h,{variant:"ghost",onClick:()=>d("/study-hall"),className:"mb-4 text-gray-400 hover:text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Back to Study Hall"]}),e.jsx(H,{className:"p-6 md:p-8 text-center bg-gray-800 border-gray-700",children:e.jsx("p",{className:"text-gray-300",children:"Error loading card. Please try again."})})]});const je=(u+1)/g.length*100,G=n.back.toLowerCase().trim(),K=f?(s=>{const t=G.replace(/\s+/g," ").trim(),i=s.toLowerCase().replace(/\s+/g," ").trim();if(t===i)return!0;const o=parseFloat(t),c=parseFloat(i);return!isNaN(o)&&!isNaN(c)?o===c:!1})(f):!1;return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[p&&b&&e.jsx(Be,{isCorrect:b.isCorrect,xpEarned:b.xpEarned,onComplete:pe}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 sm:py-6 flex flex-col flex-1 min-h-0 w-full",children:[e.jsxs("div",{className:"space-y-4 mb-4 sm:mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>d("/study-hall"),className:"h-8 w-8 text-gray-400 hover:text-white hover:bg-gray-800",children:e.jsx(R,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-1 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-300",style:{width:`${je}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:fe,disabled:u===0,className:"h-10 w-10 text-gray-400 hover:text-white hover:bg-gray-800 disabled:opacity-30",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"gap-2 bg-gray-800 border-gray-700 text-white hover:bg-gray-700",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:x.color||"#ec4899"}}),e.jsx("span",{className:"font-medium",children:x.title}),e.jsx(Ie,{className:"h-4 w-4"})]})}),e.jsx(se,{className:"bg-gray-800 border-gray-700",children:e.jsx(X,{onClick:()=>d("/study-hall"),className:"text-white hover:bg-gray-700",children:"Change Subject"})})]}),e.jsxs("div",{className:"text-sm font-medium text-pink-400",children:["+ ",W," XP"]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:V,className:"text-gray-400 hover:text-white hover:bg-gray-800",title:"Reset all progress",children:e.jsx(Oe,{className:"h-4 w-4"})})]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:Y,disabled:u===g.length-1,className:"h-10 w-10 text-gray-400 hover:text-white hover:bg-gray-800 disabled:opacity-30",children:e.jsx(Te,{className:"h-5 w-5"})})]})]}),e.jsxs(H,{className:"border-2 border-pink-500/30 bg-gray-800 rounded-lg p-4 sm:p-6 mb-3 sm:mb-4 flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:e.jsx("span",{children:"Learning"})}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-white hover:bg-gray-700",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsxs(se,{className:"bg-gray-800 border-gray-700",children:[x.user_id===m?.id&&e.jsxs(e.Fragment,{children:[e.jsx(te,{cardId:l,onItemAdded:Q,children:e.jsx(X,{onSelect:s=>s.preventDefault(),className:"text-white hover:bg-gray-700",children:"Add Card"})}),e.jsx($e,{cardId:l,cardTitle:x.title,children:e.jsx(X,{onSelect:s=>s.preventDefault(),className:"text-white hover:bg-gray-700",children:"Share"})})]}),e.jsx(X,{onClick:V,className:"text-white hover:bg-gray-700",children:"Reset"})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center overflow-y-auto",children:e.jsx("div",{className:"text-center space-y-2 sm:space-y-4 w-full px-2",children:S?e.jsxs("div",{className:"space-y-2 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-white break-words",children:n.front.includes("_")||n.front.includes("?")?n.front.replace(/[_\?]/g,n.back):n.front}),n.back&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-dashed border-gray-600 my-2"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-white break-words",children:n.back})]})]}),f&&e.jsx("div",{className:`mt-2 sm:mt-4 text-lg sm:text-xl font-semibold ${K?"text-green-400":"text-red-400"}`,children:K?"âœ“ Correct!":"âœ— Incorrect"})]}):e.jsx("div",{className:"space-y-2 sm:space-y-4",children:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-white break-words",children:n.front.includes("_")||n.front.includes("?")?n.front.replace(/[_\?]/g,"____"):n.front})})})})})]}),!S&&e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-3 sm:mb-4 flex-shrink-0",children:me.map((s,t)=>{const i=f===s,o=s.toLowerCase().trim()===G,c=f!==null;return e.jsx(h,{variant:"outline",onClick:()=>ge(s),disabled:f!==null,className:`h-14 sm:h-16 md:h-20 text-sm sm:text-base md:text-lg font-medium ${c&&o?"bg-green-600/20 border-green-500 text-green-400 hover:bg-green-600/30":c&&i&&!o?"bg-red-600/20 border-red-500 text-red-400 hover:bg-red-600/30":i?"bg-blue-600/20 border-blue-500 text-blue-400 hover:bg-blue-600/30":"bg-gray-800 border-gray-700 text-white hover:bg-gray-700"}`,children:s},t)})}),e.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[!S&&e.jsxs(h,{onClick:ue,className:"w-full h-10 sm:h-12 bg-gray-800 border-2 border-gray-700 hover:bg-gray-700 text-white font-medium",children:[e.jsx(Me,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Reveal"]}),(f!==null||S)&&u<g.length-1&&e.jsx(h,{onClick:Y,className:"w-full h-10 sm:h-12 bg-pink-500 hover:bg-pink-600 text-white font-medium",children:"Next Question"})]}),e.jsx(ie,{open:de,onOpenChange:T,children:e.jsxs(ne,{className:"bg-gray-800 border-gray-700 text-white sm:max-w-[500px]",children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-2xl font-bold text-center text-green-400",children:"Great job! ðŸŽ‰"}),e.jsxs(oe,{className:"text-center text-gray-300 pt-2",children:["You completed ",x.title," with ",F.size," out of ",g.length," correct answers."]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-lg font-semibold text-green-400",children:["Total XP Earned: ",W," XP"]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(h,{onClick:()=>{T(!1);const s=F.size,t=g.length,i=Math.round(s/t*100);E.success(`You got ${s} out of ${t} correct (${i}%)! ${s===t?"Perfect score! ðŸŽ¯":"Keep practicing!"}`,{duration:5e3})},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Re,{className:"h-5 w-5 mr-2"}),"See Correct"]}),e.jsxs(h,{onClick:()=>{T(!1),setTimeout(()=>{const s=document.getElementById("leaderboard-trigger");s&&s.click()},100)},className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white",children:[e.jsx(Fe,{className:"h-5 w-5 mr-2"}),"Leaderboards"]}),e.jsxs(h,{onClick:()=>{T(!1),d("/study-hall")},className:"w-full bg-pink-500 hover:bg-pink-600 text-white",children:[e.jsx(qe,{className:"h-5 w-5 mr-2"}),"Home"]})]})]})]})}),e.jsx(Ee,{})]})]})};export{is as default};
