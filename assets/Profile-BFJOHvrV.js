import{c as U,u as K,w as Q,b as ee,E as se,r as l,s as i,j as e,o as n,B as w}from"./index-wmXKAJ3Q.js";import{C as h}from"./card-CczKxL-i.js";import{T as te,a as re,b as f,c as g}from"./tabs-BzSC16dQ.js";import{X as ae}from"./XPBar-DlVL745Q.js";import{A as ie,L as le,c as ne,g as ce}from"./LevelUpPopup-x0rE76ca.js";import{g as X,a as C,b as oe,c as de}from"./profileStyles-BlV3Skav.js";import{T as me}from"./trophy-BIpa_Zoc.js";import{A as ue}from"./award-DgHqGv9v.js";import"./dialog-tGBwXhj-.js";const pe=U("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const he=U("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]),we=()=>{const{user:a,loading:v}=K(),{userId:b}=Q(),j=ee(),{toast:o}=se(),[t,I]=l.useState(null),[B,T]=l.useState([]),[$,M]=l.useState([]),[F,R]=l.useState([]),[_,Y]=l.useState([]),[z,P]=l.useState(!0),[q,k]=l.useState(null),[S,D]=l.useState(null),[O,W]=l.useState("achievements"),u=b||a?.id,m=!b||b===a?.id;l.useEffect(()=>{!v&&!a&&j("/auth")},[a,v,j]),l.useEffect(()=>{a&&u&&(x(),H(),m&&E())},[a,u,m]);const x=async()=>{if(!u)return;P(!0);const{data:s,error:r}=await i.from("profiles").select("*").eq("id",u).single();if(r){o({title:"Error",description:"Failed to load profile",variant:"destructive"}),j("/profile");return}s&&I(s),P(!1)},H=async()=>{if(!u)return;const{data:s}=await i.from("achievements").select("*").order("xp_required"),{data:r}=await i.from("user_achievements").select("achievement_id").eq("user_id",u);s&&T(s),r&&M(r.map(c=>c.achievement_id))},E=async()=>{if(!a?.id)return;const{data:s}=await i.from("shop_items").select("*").order("xp_cost"),{data:r}=await i.from("user_purchases").select("shop_item_id").eq("user_id",a.id);s&&R(s),r&&Y(r.map(c=>c.shop_item_id))},A=async s=>{if(!t||!a)return;if(_.includes(s.id)){const p={};s.item_type==="border"?p.border_style=s.item_value:s.item_type==="name_color"&&(p.name_color=s.item_value);const{error:J}=await i.from("profiles").update(p).eq("id",a.id);if(J){o({title:"Error",description:"Failed to equip item",variant:"destructive"});return}o({title:"Item Equipped!",description:`${s.name} has been equipped.`}),x();return}if(t.xp<s.xp_cost){o({title:"Not enough XP",description:`You need ${s.xp_cost} XP to purchase this item. Your XP will be reduced by ${s.xp_cost} when you purchase.`,variant:"destructive"});return}const{error:r}=await i.from("user_purchases").insert({user_id:a.id,shop_item_id:s.id});if(r){o({title:"Error",description:"Failed to purchase item",variant:"destructive"});return}const c=t.level,d=t.xp-s.xp_cost,y=Math.floor(d/100)+1,N={xp:d,level:y};s.item_type==="border"?N.border_style=s.item_value:s.item_type==="name_color"&&(N.name_color=s.item_value);const{error:Z}=await i.from("profiles").update(N).eq("id",a.id);if(Z){o({title:"Error",description:"Failed to update profile",variant:"destructive"});return}y<c&&await i.from("activity_logs").insert({user_id:a.id,action:"Level Down (XP Spent)",details:{old_level:c,new_level:y,xp_spent:s.xp_cost,total_xp:d}}),await i.from("activity_logs").insert({user_id:a.id,action:"Purchased item from Shop",details:{item_name:s.name,item_type:s.item_type,item_value:s.item_value,xp_cost:s.xp_cost,xp_remaining:d}});const{count:G}=await i.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",a.id),L=await ne(a.id,d,G||0);if(L.length>0){const p=await ce(L[0]);p&&k(p)}o({title:"Purchase successful!",description:`You bought and equipped ${s.name}. ${s.xp_cost} XP has been deducted from your account.`}),x(),E()},V=async s=>{if(!a||!_.includes(s.id))return;const r={};s.item_type==="border"?r.border_style="default":s.item_type==="name_color"&&(r.name_color="default");const{error:c}=await i.from("profiles").update(r).eq("id",a.id);if(c){o({title:"Error",description:"Failed to unequip item",variant:"destructive"});return}o({title:"Item Unequipped",description:`${s.name} has been unequipped.`}),x()};return v||z||!t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):e.jsxs("div",{className:"container mx-auto p-3 sm:p-4 md:p-6 lg:p-8 max-w-6xl",children:[e.jsx(ie,{achievement:q,open:!!q,onOpenChange:s=>!s&&k(null)}),e.jsx(le,{newLevel:S?.level||0,open:!!S,onOpenChange:s=>!s&&D(null)}),e.jsx(h,{className:`p-4 sm:p-6 md:p-8 mb-6 md:mb-8 bg-gradient-card ${t.border_style==="rainbow"?"":C(t.border_style)}`,style:t.border_style==="rainbow"?{}:X(t.border_style),children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 md:gap-6",children:[e.jsx("div",{className:oe(t.border_style),children:e.jsx("div",{className:`w-24 h-24 rounded-full bg-game-green/20 flex items-center justify-center text-4xl ${t.border_style==="rainbow"?"":C(t.border_style)}`,style:t.border_style==="rainbow"?{}:X(t.border_style),children:t.full_name?.[0]||"?"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:`text-3xl font-bold mb-2 ${de(t.name_color)}`,children:t.full_name}),e.jsxs("div",{className:"flex items-center gap-2 justify-center md:justify-start mb-4",children:[e.jsx(n,{variant:"secondary",children:t.role}),e.jsxs(n,{variant:"outline",className:"border-level-gold/50 text-level-gold",children:["Level ",t.level]})]}),e.jsx(ae,{currentXP:t.xp,maxXP:t.level*100,level:t.level})]})]})}),e.jsxs(te,{value:O,onValueChange:W,className:"w-full",children:[e.jsxs(re,{className:`grid w-full mb-8 ${m?"grid-cols-4":"grid-cols-2"}`,children:[e.jsxs(f,{value:"achievements",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Achievements"]}),m&&e.jsxs(f,{value:"shop",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Shop"]}),e.jsxs(f,{value:"ranks",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Ranks"]}),m&&e.jsxs(f,{value:"instructions",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"How It Works"]})]}),e.jsx(g,{value:"achievements",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.map(s=>{const r=$.includes(s.id);return e.jsxs(h,{className:`p-4 md:p-6 ${r?"bg-gradient-card border-game-green":"bg-surface opacity-60"}`,children:[e.jsx("div",{className:"text-4xl mb-3",children:s.icon}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),r?e.jsx(n,{className:"bg-game-green",children:"Unlocked"}):e.jsxs(n,{variant:"outline",children:[s.xp_required," XP Required"]})]},s.id)})})}),m&&e.jsxs(g,{value:"shop",children:[e.jsxs(h,{className:"p-3 md:p-4 mb-4 md:mb-6 bg-warning/10 border-warning/20",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"üí° How Shop Works"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:["When you purchase an item, ",e.jsx("strong",{children:"XP will be deducted"})," from your account (amount shown on each item)"]}),e.jsx("li",{children:"Purchased items are automatically equipped"}),e.jsx("li",{children:"You can equip/unequip owned items anytime"}),e.jsx("li",{children:"Your level may decrease if XP deduction causes you to drop below the current level threshold"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:F.map(s=>{const r=_.includes(s.id),c=t.xp>=s.xp_cost,d=s.item_type==="border"&&t.border_style===s.item_value||s.item_type==="name_color"&&t.name_color===s.item_value;return e.jsxs(h,{className:"p-4 md:p-6 bg-surface border-border/50",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{variant:"secondary",children:[s.xp_cost," XP"]}),d&&e.jsx(n,{className:"bg-level-gold",children:"Equipped"}),r&&!d&&e.jsx(n,{className:"bg-game-green",children:"Owned"})]}),e.jsx("div",{className:"flex gap-2",children:r?e.jsx(e.Fragment,{children:d?e.jsx(w,{size:"sm",variant:"outline",onClick:()=>V(s),className:"flex-1",children:"Unequip"}):e.jsx(w,{size:"sm",onClick:()=>A(s),className:"flex-1 bg-game-green hover:bg-game-green-dark",children:"Equip"})}):e.jsx(w,{size:"sm",onClick:()=>A(s),disabled:!c,className:"flex-1",children:"Buy & Equip"})})]})]},s.id)})})]}),e.jsx(g,{value:"ranks",children:e.jsxs(h,{className:"p-6 bg-surface",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Level Rankings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-card rounded-lg",children:[e.jsx("span",{className:"font-semibold",children:"Level 1-5"}),e.jsx(n,{children:"Novice"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-card rounded-lg",children:[e.jsx("span",{className:"font-semibold",children:"Level 6-10"}),e.jsx(n,{className:"bg-blue-500",children:"Apprentice"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-card rounded-lg",children:[e.jsx("span",{className:"font-semibold",children:"Level 11-20"}),e.jsx(n,{className:"bg-purple-500",children:"Expert"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-card rounded-lg",children:[e.jsx("span",{className:"font-semibold",children:"Level 21+"}),e.jsx(n,{className:"bg-game-green",children:"Master"})]})]})]})}),m&&e.jsx(g,{value:"instructions",children:e.jsxs(h,{className:"p-6 md:p-8 bg-surface",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"How to Earn Points & Level Up"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-game-green",children:"üìö Share Study Materials"}),e.jsxs("p",{className:"text-muted-foreground",children:["Upload and share your study notes, guides, or resources with the community. Earn ",e.jsx("strong",{children:"50 XP"})," per material shared."]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-game-green",children:"üí° Share Study Strategies"}),e.jsxs("p",{className:"text-muted-foreground",children:["Post effective study techniques and strategies that help others learn better. Earn ",e.jsx("strong",{children:"30 XP"})," per strategy shared."]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-game-green",children:"üéØ Share Ideas"}),e.jsxs("p",{className:"text-muted-foreground",children:["Contribute creative learning ideas and tips. Earn ",e.jsx("strong",{children:"20 XP"})," per idea shared."]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-game-green",children:"üèÜ Unlock Achievements"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete milestones to unlock special achievements. Each achievement adds to your profile showcase!"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-game-green",children:"üõçÔ∏è Shop Customizations"}),e.jsx("p",{className:"text-muted-foreground",children:"Use your earned XP to purchase exclusive profile borders and name colors from the shop."})]})]})]})})]})]})};export{we as default};
