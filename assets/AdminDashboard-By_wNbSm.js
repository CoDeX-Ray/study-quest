import{c as $,j as e,n as R,b as B,a as L,r as d,B as c,s as o}from"./index-wmXKAJ3Q.js";import{C as n}from"./card-CczKxL-i.js";import{T as S,a as T,b as u,c as h}from"./tabs-BzSC16dQ.js";import{U as g}from"./users-Bnmdk7Wu.js";import{B as v}from"./bug-DKYx5UWu.js";import{A as N}from"./activity-CfmS3bP4.js";const w=$("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function y({className:r,...l}){return e.jsx("div",{className:R("animate-pulse rounded-md bg-muted",r),...l})}const q=()=>{const r=B(),{isAdmin:l,loading:p}=L(),[m,A]=d.useState({totalUsers:0,totalBugReports:0,openBugReports:0,recentActivities:0}),[j,k]=d.useState([]),[_,C]=d.useState(!0);return d.useEffect(()=>{!p&&!l&&r("/dashboard")},[l,p,r]),d.useEffect(()=>{l&&(async()=>{const[i,a,t,b]=await Promise.all([o.from("profiles").select("id",{count:"exact",head:!0}),o.from("bug_reports").select("id, status",{count:"exact"}),o.from("activity_logs").select("id",{count:"exact",head:!0}),o.from("activity_logs").select("*").order("created_at",{ascending:!1}).limit(10)]);if(A({totalUsers:i.count||0,totalBugReports:a.count||0,openBugReports:a.data?.filter(f=>f.status==="open").length||0,recentActivities:t.count||0}),b.data){const f=await Promise.all(b.data.map(async x=>{if(x.user_id){const{data:U}=await o.from("profiles").select("full_name, email").eq("id",x.user_id).single();return{...x,profiles:U}}return{...x}}));k(f)}C(!1)})()},[l]),p||_?e.jsx("div",{className:"min-h-screen bg-background p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(y,{className:"h-12 w-64"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-4",children:[...Array(4)].map((s,i)=>e.jsx(y,{className:"h-32"},i))})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-destructive/5 via-background to-warning/5 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(w,{className:"h-10 w-10 text-destructive"}),"Admin Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and monitor your platform"})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-4",children:[e.jsx(n,{className:"p-6 border-border/50 bg-surface hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:m.totalUsers})]}),e.jsx(g,{className:"h-12 w-12 text-primary"})]})}),e.jsx(n,{className:"p-6 border-border/50 bg-surface hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bug Reports"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:m.totalBugReports})]}),e.jsx(v,{className:"h-12 w-12 text-warning"})]})}),e.jsx(n,{className:"p-6 border-border/50 bg-surface hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Open Issues"}),e.jsx("p",{className:"text-3xl font-bold text-destructive",children:m.openBugReports})]}),e.jsx(w,{className:"h-12 w-12 text-destructive"})]})}),e.jsx(n,{className:"p-6 border-border/50 bg-surface hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Activities"}),e.jsx("p",{className:"text-3xl font-bold text-foreground",children:m.recentActivities})]}),e.jsx(N,{className:"h-12 w-12 text-accent"})]})})]}),e.jsxs(S,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(T,{className:"bg-surface border border-border",children:[e.jsx(u,{value:"overview",children:"Overview"}),e.jsx(u,{value:"users",children:"Users"}),e.jsx(u,{value:"bugs",children:"Bug Reports"}),e.jsx(u,{value:"logs",children:"Activity Logs"})]}),e.jsx(h,{value:"overview",className:"space-y-4",children:e.jsxs(n,{className:"p-6 border-border/50 bg-surface",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Quick Actions"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(c,{onClick:()=>r("/admin/users"),className:"w-full",variant:"outline",children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Manage Users"]}),e.jsxs(c,{onClick:()=>r("/admin/bug-reports"),className:"w-full",variant:"outline",children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"View Bug Reports"]}),e.jsxs(c,{onClick:()=>r("/admin/activity-logs"),className:"w-full",variant:"outline",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Activity Logs"]})]})]})}),e.jsx(h,{value:"users",children:e.jsxs(n,{className:"p-6 border-border/50 bg-surface",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"User Management"}),e.jsx(c,{onClick:()=>r("/admin/users"),children:"View All Users"})]})}),e.jsx(h,{value:"bugs",children:e.jsxs(n,{className:"p-6 border-border/50 bg-surface",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Bug Reports"}),e.jsx(c,{onClick:()=>r("/admin/bug-reports"),children:"View All Reports"})]})}),e.jsx(h,{value:"logs",children:e.jsxs(n,{className:"p-6 border-border/50 bg-surface",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recent Activity Logs"}),e.jsx(c,{onClick:()=>r("/admin/activity-logs"),children:"View All Logs"})]}),e.jsx("div",{className:"space-y-3",children:j.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No recent activities"}):j.map(s=>{const i=s.profiles?.full_name||s.profiles?.email||"Unknown";let a="";if(s.action==="Posted content in Community"&&s.details){const t=s.details;a=`${i} posted content: "${t.post_title||"Untitled"}" (${t.post_type||"post"})`,t.content_preview&&(a+=` - ${t.content_preview}`)}else if(s.action==="Liked post in Community"&&s.details){const t=s.details;a=`${i} liked post: "${t.post_title||"Untitled"}"`}else if(s.action==="Unliked post in Community"&&s.details){const t=s.details;a=`${i} unliked post: "${t.post_title||"Untitled"}"`}else if(s.action==="Commented on post in Community"&&s.details){const t=s.details;a=`${i} commented on post: "${t.post_title||"Untitled"}"`}else if(s.action==="Shared post in Community"&&s.details){const t=s.details;a=`${i} shared post: "${t.post_title||"Untitled"}"`}else if(s.action==="Deleted post in Community"&&s.details){const t=s.details;a=`${i} deleted post: "${t.post_title||"Untitled"}"`}else s.action==="Signed in"?a=`${i} signed in`:s.action==="Signed out"?a=`${i} signed out`:a=`${i}: ${s.action}`;return e.jsxs("div",{className:"p-3 bg-background/50 rounded-lg border border-border/50",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.created_at).toLocaleString()})]},s.id)})})]})})]})]})})};export{q as default};
