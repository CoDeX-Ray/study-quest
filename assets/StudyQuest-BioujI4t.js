import{c as E,u as re,r as a,s as k,j as e,n as ye,o as ae,B as m,h as D,X as T,b as be,p as Ne,D as Z,d as ee,e as se,f as B}from"./index-Ded0JyBH.js";import{C as X}from"./card-DvR7wfGF.js";import{D as le,a as ve,b as ne,c as ie,d as ce,e as oe}from"./dialog-DBPC4a0B.js";import{I as Ce}from"./input-BajuTDme.js";import{A as Se,a as ke,b as _e,S as Ae,L as De}from"./LeaderboardDialog-DxwKxOYU.js";import{S as Ee}from"./search-B9B32OEk.js";import{A as te,E as Le}from"./AddCardItemDialog-C6IGcZoB.js";import{C as ze}from"./chevron-down-BMscWK09.js";import{T as Ie}from"./trophy-gnYbsPnn.js";import"./tabs-C4sFRiPo.js";import"./award-DFx4-MBN.js";import"./label-Btgt0f0x.js";import"./textarea-Dxjc3OmK.js";import"./switch-DPjt8zPz.js";import"./index-gRRgytIV.js";const Me=E("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);const Fe=E("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);const Te=E("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);const Pe=E("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Re=E("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const qe=E("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Oe=({children:h,cardId:b,cardTitle:d})=>{const{user:N}=re(),[i,u]=a.useState(!1),[L,g]=a.useState(""),[P,x]=a.useState([]),[C,f]=a.useState(new Set),[_,v]=a.useState(!1),[z,$]=a.useState(!1);a.useEffect(()=>{i&&(A(),I())},[i]);const A=async()=>{if(N)try{const{data:r,error:p}=await k.from("profiles").select("id, full_name, avatar_url, email, role").neq("id",N.id).limit(100);if(p)throw p;x(r||[])}catch(r){console.error("Error fetching users:",r)}},I=async()=>{try{const{data:r,error:p}=await k.from("shared_cards").select("shared_with_user_id").eq("card_id",b);if(p)throw p;r&&f(new Set(r.map(S=>S.shared_with_user_id)))}catch(r){console.error("Error fetching shared with:",r)}},M=async r=>{if(N){v(!0);try{const{error:p}=await k.from("shared_cards").insert({card_id:b,shared_by_user_id:N.id,shared_with_user_id:r});if(p)throw p;f(S=>new Set([...S,r])),D.success("Card shared successfully!")}catch(p){D.error(p.message||"Failed to share card")}finally{v(!1)}}},R=P.filter(r=>r.full_name?.toLowerCase().includes(L.toLowerCase())||r.email.toLowerCase().includes(L.toLowerCase()));return e.jsxs(le,{open:i,onOpenChange:u,children:[e.jsx(ve,{asChild:!0,children:h}),e.jsxs(ne,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsxs(ce,{children:['Share "',d,'"']}),e.jsx(oe,{children:"Share this study card deck with others"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search friends...",value:L,onChange:r=>g(r.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto space-y-2",children:R.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:P.length===0?e.jsx("p",{children:"No users available to share with."}):e.jsx("p",{children:"No users match your search."})}):R.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Se,{className:"h-10 w-10",children:[e.jsx(ke,{src:r.avatar_url||void 0}),e.jsx(_e,{children:r.full_name?.charAt(0)||"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.full_name||"Anonymous"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]})]}),C.has(r.id)?e.jsxs(ye,{variant:"outline",className:"gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),"Shared"]}):e.jsx(m,{size:"sm",onClick:()=>M(r.id),disabled:_,children:"Share"})]},r.id))})]})]})]})},Be=({isCorrect:h,xpEarned:b=0,onComplete:d})=>{const[N,i]=a.useState(!0);return a.useEffect(()=>{const u=setTimeout(()=>{i(!1),setTimeout(d,300)},2e3);return()=>clearTimeout(u)},[d]),N?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-300",onClick:d,children:e.jsx("div",{className:`relative p-8 md:p-12 rounded-2xl shadow-2xl animate-in zoom-in-95 duration-300 ${h?"bg-green-500":"bg-red-500"}`,children:e.jsx("div",{className:"flex flex-col items-center gap-4",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin-slow",children:e.jsx(ae,{className:"h-16 md:h-20 w-16 md:w-20 text-white"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white animate-in slide-in-from-bottom-4 duration-500",children:"Correct!"}),b>0&&e.jsxs("div",{className:"flex items-center gap-2 text-xl md:text-2xl font-bold text-yellow-300 animate-in slide-in-from-bottom-4 duration-700 delay-300",children:[e.jsx(Ae,{className:"h-5 w-5 md:h-6 md:w-6 fill-yellow-300"}),"+",b," XP"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(T,{className:"h-16 md:h-20 w-16 md:w-20 text-white"})}),e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white animate-in slide-in-from-bottom-4 duration-500",children:"Wrong"})]})})})}):null},as=()=>{const{user:h,loading:b}=re(),d=be(),[N]=Ne(),i=N.get("card"),[u,L]=a.useState(null),[g,P]=a.useState([]),[x,C]=a.useState(0),[f,_]=a.useState(null),[v,z]=a.useState(!1),[$,A]=a.useState(new Set),[I,M]=a.useState(new Set),[R,r]=a.useState(!0),[p,S]=a.useState(!1),[H,U]=a.useState(null),[W,q]=a.useState(0),[de,F]=a.useState(!1);a.useEffect(()=>{!b&&!h&&d("/auth")},[h,b,d]),a.useEffect(()=>{h&&i?Q():h&&!i&&d("/study-hall")},[h,i,d]);const he=s=>{const t=s.trim();let l=[t];const o=parseFloat(t);if(isNaN(o)){const c=[t+"s",t.substring(0,Math.max(0,t.length-1)),t.toUpperCase(),t.charAt(0).toUpperCase()+t.slice(1)].filter(w=>w!==t);l=[t,...c].slice(0,4)}else{const c=[o+1,o-1,o===0?1:o*2].filter((w,j,O)=>O.indexOf(w)===j&&w!==o);l=[t,...c.map(String)].slice(0,4)}for(let c=l.length-1;c>0;c--){const w=Math.floor(Math.random()*(c+1));[l[c],l[w]]=[l[w],l[c]]}return l},n=g[x],me=a.useMemo(()=>n?he(n.back):[],[n]);a.useEffect(()=>{i&&(C(0),z(!1),_(null),A(new Set),M(new Set),S(!1),U(null),q(0))},[i]),a.useEffect(()=>{z(!1),_(null)},[x]);const Q=async()=>{if(i){r(!0);try{const{data:s,error:t}=await k.from("study_cards").select("*").eq("id",i).single();if(t)throw t;const l=s.user_id===h?.id,o=s.is_public,c=await xe(i);if(!l&&!o&&!c){D.error("You don't have access to this card"),d("/study-hall");return}L(s);const{data:w,error:j}=await k.from("study_card_items").select("*").eq("card_id",i).order("order_index",{ascending:!0});if(j)throw j;P(w||[])}catch(s){console.error("Error fetching card:",s),D.error(s.message||"Failed to load card"),r(!1),setTimeout(()=>{d("/study-hall")},2e3);return}finally{r(!1)}}},xe=async s=>{if(!h)return!1;const{data:t}=await k.from("shared_cards").select("id").eq("card_id",s).eq("shared_with_user_id",h.id).single();return!!t},ue=()=>{if(n&&(z(!0),f===null)){const s=n.id;A(t=>new Set([...t,s]))}},ge=s=>{if(!n||v||f!==null)return;_(s);const t=n.id,l=n.back.toLowerCase().trim(),o=s.toLowerCase().trim(),c=l.replace(/\s+/g," ").trim(),w=o.replace(/\s+/g," ").trim();let j=c===w;if(!j){const y=parseFloat(c),J=parseFloat(w);!isNaN(y)&&!isNaN(J)&&(j=y===J)}A(y=>new Set([...y,t]));const O=j?10:0;j?(M(y=>new Set([...y,t])),q(y=>y+O)):q(y=>y+0),U({isCorrect:j,xpEarned:O}),S(!0)},Y=()=>{x<g.length-1&&C(x+1)},fe=()=>{x>0&&C(x-1)},V=()=>{C(0),z(!1),_(null),A(new Set),M(new Set),q(0)},pe=()=>{S(!1),U(null),setTimeout(()=>{x<g.length-1?C(x+1):$.size===g.length&&we()},1e3)},we=async()=>{if(!(!h||!i||g.length===0))try{const s=$.size,t=I.size,l=t*10,{error:o}=await k.from("study_sessions").insert({user_id:h.id,card_id:i,questions_answered:s,correct_answers:t,xp_earned:l,session_date:new Date().toISOString().split("T")[0]});if(o)throw o;F(!0)}catch(s){console.error("Error saving study session:",s),D.error(s.message||"Failed to save progress")}};if(b||R)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto"}),e.jsx("p",{className:"text-gray-400",children:"Loading..."})]})});if(!u)return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:[e.jsxs(m,{variant:"ghost",onClick:()=>d("/study-hall"),className:"mb-4 text-gray-400 hover:text-white",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Back to Study Hall"]}),e.jsx(X,{className:"p-6 md:p-8 text-center bg-gray-800 border-gray-700",children:e.jsx("p",{className:"text-gray-300",children:"Card deck not found."})})]});if(g.length===0)return e.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"ghost",onClick:()=>d("/study-hall"),className:"text-gray-400 hover:text-white",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:u.title}),u.description&&e.jsx("p",{className:"text-sm text-gray-400",children:u.description})]})]})}),e.jsxs(X,{className:"p-8 text-center space-y-4 bg-gray-800 border-gray-700",children:[e.jsx("p",{className:"text-gray-300",children:"No flashcards in this deck yet."}),u.user_id===h?.id&&e.jsx(te,{cardId:i,onItemAdded:Q,children:e.jsx(m,{className:"bg-pink-500 hover:bg-pink-600",children:"Add First Card"})})]})]})});if(!n||!g[x])return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4 md:p-6",children:[e.jsxs(m,{variant:"ghost",onClick:()=>d("/study-hall"),className:"mb-4 text-gray-400 hover:text-white",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Back to Study Hall"]}),e.jsx(X,{className:"p-6 md:p-8 text-center bg-gray-800 border-gray-700",children:e.jsx("p",{className:"text-gray-300",children:"Error loading card. Please try again."})})]});const je=(x+1)/g.length*100,G=n.back.toLowerCase().trim(),K=f?(s=>{const t=G.replace(/\s+/g," ").trim(),l=s.toLowerCase().replace(/\s+/g," ").trim();if(t===l)return!0;const o=parseFloat(t),c=parseFloat(l);return!isNaN(o)&&!isNaN(c)?o===c:!1})(f):!1;return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex flex-col",children:[p&&H&&e.jsx(Be,{isCorrect:H.isCorrect,xpEarned:H.xpEarned,onComplete:pe}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 sm:py-6 flex flex-col flex-1 min-h-0 w-full",children:[e.jsxs("div",{className:"space-y-4 mb-4 sm:mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>d("/study-hall"),className:"h-8 w-8 text-gray-400 hover:text-white hover:bg-gray-800",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsx("div",{className:"h-1 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-pink-500 transition-all duration-300",style:{width:`${je}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:fe,disabled:x===0,className:"h-10 w-10 text-gray-400 hover:text-white hover:bg-gray-800 disabled:opacity-30",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"gap-2 bg-gray-800 border-gray-700 text-white hover:bg-gray-700",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:u.color||"#ec4899"}}),e.jsx("span",{className:"font-medium",children:u.title}),e.jsx(ze,{className:"h-4 w-4"})]})}),e.jsx(se,{className:"bg-gray-800 border-gray-700",children:e.jsx(B,{onClick:()=>d("/study-hall"),className:"text-white hover:bg-gray-700",children:"Change Subject"})})]}),e.jsxs("div",{className:"text-sm font-medium text-pink-400",children:["+ ",W," XP"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:V,className:"text-gray-400 hover:text-white hover:bg-gray-800",title:"Reset all progress",children:e.jsx(qe,{className:"h-4 w-4"})})]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:Y,disabled:x===g.length-1,className:"h-10 w-10 text-gray-400 hover:text-white hover:bg-gray-800 disabled:opacity-30",children:e.jsx(Te,{className:"h-5 w-5"})})]})]}),e.jsxs(X,{className:"border-2 border-pink-500/30 bg-gray-800 rounded-lg p-4 sm:p-6 mb-3 sm:mb-4 flex-1 min-h-0 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:e.jsx("span",{children:"Learning"})}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-white hover:bg-gray-700",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(se,{className:"bg-gray-800 border-gray-700",children:[u.user_id===h?.id&&e.jsxs(e.Fragment,{children:[e.jsx(te,{cardId:i,onItemAdded:Q,children:e.jsx(B,{onSelect:s=>s.preventDefault(),className:"text-white hover:bg-gray-700",children:"Add Card"})}),e.jsx(Oe,{cardId:i,cardTitle:u.title,children:e.jsx(B,{onSelect:s=>s.preventDefault(),className:"text-white hover:bg-gray-700",children:"Share"})})]}),e.jsx(B,{onClick:V,className:"text-white hover:bg-gray-700",children:"Reset"})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center overflow-y-auto",children:e.jsx("div",{className:"text-center space-y-2 sm:space-y-4 w-full px-2",children:v?e.jsxs("div",{className:"space-y-2 sm:space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-white break-words",children:n.front.includes("_")||n.front.includes("?")?n.front.replace(/[_\?]/g,n.back):n.front}),n.back&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-dashed border-gray-600 my-2"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-semibold text-white break-words",children:n.back})]})]}),f&&e.jsx("div",{className:`mt-2 sm:mt-4 text-lg sm:text-xl font-semibold ${K?"text-green-400":"text-red-400"}`,children:K?"âœ“ Correct!":"âœ— Incorrect"})]}):e.jsx("div",{className:"space-y-2 sm:space-y-4",children:e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-white break-words",children:n.front.includes("_")||n.front.includes("?")?n.front.replace(/[_\?]/g,"____"):n.front})})})})})]}),!v&&e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 mb-3 sm:mb-4 flex-shrink-0",children:me.map((s,t)=>{const l=f===s,o=s.toLowerCase().trim()===G,c=f!==null;return e.jsx(m,{variant:"outline",onClick:()=>ge(s),disabled:f!==null,className:`h-14 sm:h-16 md:h-20 text-sm sm:text-base md:text-lg font-medium ${c&&o?"bg-green-600/20 border-green-500 text-green-400 hover:bg-green-600/30":c&&l&&!o?"bg-red-600/20 border-red-500 text-red-400 hover:bg-red-600/30":l?"bg-blue-600/20 border-blue-500 text-blue-400 hover:bg-blue-600/30":"bg-gray-800 border-gray-700 text-white hover:bg-gray-700"}`,children:s},t)})}),e.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[!v&&e.jsxs(m,{onClick:ue,className:"w-full h-10 sm:h-12 bg-gray-800 border-2 border-gray-700 hover:bg-gray-700 text-white font-medium",children:[e.jsx(Me,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Reveal"]}),(f!==null||v)&&x<g.length-1&&e.jsx(m,{onClick:Y,className:"w-full h-10 sm:h-12 bg-pink-500 hover:bg-pink-600 text-white font-medium",children:"Next Question"})]}),e.jsx(le,{open:de,onOpenChange:F,children:e.jsxs(ne,{className:"bg-gray-800 border-gray-700 text-white sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsx(ce,{className:"text-2xl font-bold text-center text-green-400",children:"Great job! ðŸŽ‰"}),e.jsxs(oe,{className:"text-center text-gray-300 pt-2",children:["You completed ",u.title," with ",I.size," out of ",g.length," correct answers."]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-lg font-semibold text-green-400",children:["Total XP Earned: ",W," XP"]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(m,{onClick:()=>{F(!1);const s=I.size,t=g.length,l=Math.round(s/t*100);D.success(`You got ${s} out of ${t} correct (${l}%)! ${s===t?"Perfect score! ðŸŽ¯":"Keep practicing!"}`,{duration:5e3})},className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Pe,{className:"h-5 w-5 mr-2"}),"See Correct"]}),e.jsxs(m,{onClick:()=>{F(!1),setTimeout(()=>{const s=document.getElementById("leaderboard-trigger");s&&s.click()},100)},className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white",children:[e.jsx(Ie,{className:"h-5 w-5 mr-2"}),"Leaderboards"]}),e.jsxs(m,{onClick:()=>{F(!1),d("/study-hall")},className:"w-full bg-pink-500 hover:bg-pink-600 text-white",children:[e.jsx(Re,{className:"h-5 w-5 mr-2"}),"Home"]})]})]})]})}),e.jsx(De,{})]})]})};export{as as default};
