import{c as de,u as le,b as ie,w as ne,r as a,s as c,h as r,j as e,B as d,D as ce,d as oe,e as ue,f as q}from"./index-BC4Bl_DL.js";import{C as z}from"./card-BtsZ4tCb.js";import{A as F,E as me}from"./AddCardItemDialog-Cte16E_X.js";import{A as T,a as O,b as L,c as I,d as P,e as B,f as M,g as Q}from"./alert-dialog-B3ifWKCD.js";import{D as he,b as xe,c as fe,d as ge}from"./dialog-DkqcDn-U.js";import{T as R}from"./textarea-NBqID4KY.js";import{L as H}from"./label-DW17_Th8.js";import{A as je}from"./arrow-left-B0aaM0S4.js";import{T as V}from"./trash-2-BMDkZUlD.js";import{P as Y}from"./plus-CSR7nEbG.js";import{R as pe}from"./rocket-DYRQNu0B.js";import"./switch-D_mjIXcH.js";import"./index-Cihyj4XF.js";const be=de("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Fe=()=>{const{user:l,loading:h}=le(),i=ie(),{deckId:t}=ne(),[o,$]=a.useState(null),[x,G]=a.useState([]),[J,D]=a.useState(!0),[K,f]=a.useState(!1),[g,y]=a.useState(!1),[C,j]=a.useState(null),[p,k]=a.useState(""),[b,w]=a.useState(""),[U,u]=a.useState(!1),[W,N]=a.useState(!1),[A,E]=a.useState(null),[v,S]=a.useState(!1);a.useEffect(()=>{!h&&!l&&i("/auth")},[l,h,i]),a.useEffect(()=>{l&&t&&n()},[l,t]);const n=async()=>{if(t){D(!0);try{const{data:s,error:m}=await c.from("study_cards").select("*").eq("id",t).single();if(m)throw m;if(s.user_id!==l?.id){r.error("You don't have access to this deck"),i("/study-hall");return}$(s);const{data:re,error:_}=await c.from("study_card_items").select("*").eq("card_id",t).order("order_index",{ascending:!0});if(_)throw _;G(re||[])}catch(s){r.error(s.message||"Failed to load deck"),i("/study-hall")}finally{D(!1)}}},X=async()=>{if(!(!t||!l)){y(!0);try{const{error:s}=await c.from("study_cards").delete().eq("id",t).eq("user_id",l.id);if(s)throw s;r.success("Deck deleted successfully"),i("/study-hall")}catch(s){r.error(s.message||"Failed to delete deck")}finally{y(!1),f(!1)}}},Z=()=>{if(x.length===0){r.error("Please add at least one card before starting");return}i(`/study-quest?card=${t}`)},ee=s=>{j(s),k(s.front),w(s.back),u(!0)},se=async()=>{if(!C||!p.trim()||!b.trim()){r.error("Please fill in both front and back");return}try{const{error:s}=await c.from("study_card_items").update({front:p.trim(),back:b.trim(),updated_at:new Date().toISOString()}).eq("id",C.id);if(s)throw s;r.success("Card updated successfully"),u(!1),j(null),n()}catch(s){r.error(s.message||"Failed to update card")}},ae=async()=>{if(A){S(!0);try{const{error:s}=await c.from("study_card_items").delete().eq("id",A).eq("card_id",t);if(s)throw s;r.success("Card deleted successfully"),N(!1),E(null),n()}catch(s){r.error(s.message||"Failed to delete card")}finally{S(!1)}}},te=s=>{E(s),N(!0)};return h?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-game-green mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):J?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-game-green mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading deck..."})]})}):o?e.jsxs("div",{className:"min-h-screen bg-background p-3 md:p-4 lg:p-6",children:[e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-background/95 backdrop-blur-sm pb-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i("/study-hall"),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:o.color}}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:o.title})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>f(!0),className:"text-destructive hover:text-destructive",children:e.jsx(V,{className:"h-4 w-4"})})})]})}),x.length===0?e.jsx(z,{className:"p-8 md:p-12 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),e.jsx("h3",{className:"text-xl font-semibold",children:"No cards yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Add some cards to start quizzing."}),e.jsx(F,{cardId:t,onItemAdded:n,children:e.jsxs(d,{size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Card"]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-background/95 backdrop-blur-sm pb-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(F,{cardId:t,onItemAdded:n,children:e.jsxs(d,{variant:"outline",size:"lg",className:"flex-1",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Add Card"]})}),e.jsxs(d,{onClick:Z,size:"lg",className:"bg-blue-600 hover:bg-blue-700 flex-1",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Start Quest"]})]})}),e.jsx("div",{className:"space-y-3",children:x.map((s,m)=>e.jsx(z,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:["Card ",m+1]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Front:"}),e.jsx("p",{className:"font-medium",children:s.front})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Back:"}),e.jsx("p",{className:"text-muted-foreground",children:s.back})]})]}),e.jsxs(ce,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(ue,{align:"end",children:[e.jsxs(q,{onClick:()=>ee(s),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(q,{onClick:()=>te(s.id),className:"text-destructive",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})},s.id))})]})]}),e.jsx(T,{open:K,onOpenChange:f,children:e.jsxs(O,{children:[e.jsxs(L,{children:[e.jsx(I,{children:"Delete Deck"}),e.jsxs(P,{children:['Are you sure you want to delete "',o.title,'"? This action cannot be undone and will delete all cards in this deck.']})]}),e.jsxs(B,{children:[e.jsx(M,{disabled:g,children:"Cancel"}),e.jsx(Q,{onClick:X,disabled:g,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:g?"Deleting...":"Delete"})]})]})}),e.jsx(he,{open:U,onOpenChange:u,children:e.jsxs(xe,{className:"sm:max-w-[500px]",children:[e.jsx(fe,{children:e.jsx(ge,{children:"Edit Card"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"edit-front",children:"Front (Question) *"}),e.jsx(R,{id:"edit-front",value:p,onChange:s=>k(s.target.value),placeholder:"Enter the question or front side of the card",rows:3,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"edit-back",children:"Back (Answer) *"}),e.jsx(R,{id:"edit-back",value:b,onChange:s=>w(s.target.value),placeholder:"Enter the answer or back side of the card",rows:3,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{u(!1),j(null)},children:"Cancel"}),e.jsx(d,{onClick:se,children:"Save Changes"})]})]})]})}),e.jsx(T,{open:W,onOpenChange:N,children:e.jsxs(O,{children:[e.jsxs(L,{children:[e.jsx(I,{children:"Delete Card"}),e.jsx(P,{children:"Are you sure you want to delete this card? This action cannot be undone."})]}),e.jsxs(B,{children:[e.jsx(M,{disabled:v,children:"Cancel"}),e.jsx(Q,{onClick:ae,disabled:v,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:v?"Deleting...":"Delete"})]})]})})]}):null};export{Fe as default};
